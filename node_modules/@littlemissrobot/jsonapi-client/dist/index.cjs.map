{"version":3,"sources":["../src/index.ts","../src/Container.ts","../src/Client.ts","../src/errors/ConfigValuesNotSetError.ts","../src/errors/FalsyConfigValueError.ts","../src/errors/UnknownConfigValueError.ts","../src/Config.ts","../src/errors/UnknownMacroError.ts","../src/MacroRegistry.ts","../src/AutoMapper.ts","../src/typeguards/isResponseWithData.ts","../src/ResponseModel.ts","../src/Model.ts","../src/ResultSet.ts","../src/errors/InvalidResponseError.ts","../src/typeguards/isJsonApiResponse.ts","../src/typeguards/isRawResponse.ts","../src/typeguards/isResponseWithErrors.ts","../src/utils/http.ts","../src/QueryBuilder.ts","../src/errors/AuthTokenError.ts","../src/auth/OAuth.ts","../src/EventBus.ts","../src/JsonApi.ts","../src/facades/events.ts","../src/facades/query.ts","../src/facades/client.ts"],"sourcesContent":["export type * from \"./types/index\";\n\nexport { default as JsonApi } from \"./JsonApi\";\nexport { default as Container } from \"./Container\";\nexport { default as AutoMapper } from \"./AutoMapper\";\nexport { default as Client } from \"./Client\";\nexport { default as Config } from \"./Config\";\nexport { default as MacroRegistry } from \"./MacroRegistry\";\nexport { default as Model } from \"./Model\";\nexport { default as QueryBuilder } from \"./QueryBuilder\";\nexport { default as ResponseModel } from \"./ResponseModel\";\nexport { default as ResultSet } from \"./ResultSet\";\nexport { default as OAuth } from \"./auth/OAuth\";\n\n// Facades\nexport { events, on, off } from \"./facades/events\";\nexport { default as query } from \"./facades/query\";\nexport { default as client } from \"./facades/client\";\n","import {TContainerBindingFunction} from \"./types/container-binding-function\";\n\nexport default class Container {\n\t/**\n\t * @private\n\t */\n\tprivate static bindings: Record<string, TContainerBindingFunction> = {};\n\n\t/**\n\t * @private\n\t */\n\tprivate static singletonBindings: Record<string, TContainerBindingFunction> = {};\n\n\t/**\n\t *\n\t * @private\n\t */\n\tprivate static instances: Record<string, any> = {};\n\n\t/**\n\t *\n\t * @param name\n\t * @param bindingCall\n\t */\n\tpublic static bind(name: string, bindingCall: TContainerBindingFunction): void {\n\t\tthis.bindings[name] = bindingCall;\n\t}\n\n\t/**\n\t *\n\t * @param name\n\t * @param bindingCall\n\t */\n\tpublic static singleton(name: string, bindingCall: TContainerBindingFunction): void {\n\t\tthis.singletonBindings[name] = bindingCall;\n\t}\n\n\t/**\n\t *\n\t * @param name\n\t * @private\n\t */\n\tprivate static getBinding(name: string): TContainerBindingFunction {\n\t\tif (!this.bindings[name]) {\n\t\t\tthrow new Error(`No dependency was found for name \"${name}\"`);\n\t\t}\n\n\t\treturn this.bindings[name];\n\t}\n\n\t/**\n\t * Makes and retrieves a new instance\n\t * @param name\n\t * @param args\n\t */\n\tpublic static make(name: string, ...args: any[]): any {\n\t\t// First check if it's a singleton instance we have to make\n\t\tif (this.singletonBindings[name]) {\n\t\t\t// Does it already exist?\n\t\t\tif (!this.instances[name]) {\n\t\t\t\t// If not, make it and store it in instances\n\t\t\t\tthis.instances[name] = this.singletonBindings[name](...args);\n\t\t\t}\n\n\t\t\treturn this.instances[name];\n\t\t}\n\n\t\treturn this.getBinding(name)(...args);\n\t}\n}","import type { ClientInterface } from './contracts/ClientInterface';\nimport { AuthInterface } from \"./contracts/AuthInterface\";\n\nexport default class Client implements ClientInterface {\n    /**\n     * @private\n     */\n    private readonly auth: AuthInterface;\n\n    /**\n     * @private\n     */\n    private readonly baseUrl: string;\n\n    /**\n     * @param auth\n     * @param baseUrl\n     */\n    constructor(auth: AuthInterface, baseUrl: string) {\n        this.auth = auth;\n        this.baseUrl = baseUrl;\n    }\n\n    /**\n     * Fetches the API with a GET request\n     */\n    public async get(path: string, options = {}): Promise<unknown> {\n        const authHeaders = await this.auth.getHttpHeaders();\n\n        const response = await fetch(`${this.baseUrl}/${path}`, {\n            ...options,\n            method: 'GET',\n            headers: new Headers({\n                ...authHeaders,\n                Accept: 'application/vnd.api+json',\n            }),\n        });\n\n        try {\n            return await response.json();\n        } catch (e: unknown) {\n            throw new Error('Response was not valid JSON.');\n        }\n    }\n\n    /**\n     * Fetches the API with a POST request\n     */\n    public async post(path: string, body: any, options = {}): Promise<unknown> {\n        const authHeaders = await this.auth.getHttpHeaders();\n\n        const response = await fetch(`${this.baseUrl}/${path}`, {\n            ...options,\n            method: 'POST',\n            headers: new Headers({\n                ...authHeaders,\n                Accept: 'application/json',\n                'Content-Type': 'application/json',\n            }),\n            body: JSON.stringify(body)\n        });\n\n        try {\n            return await response.json();\n        } catch (e: unknown) {\n            throw new Error('Response was not valid JSON.');\n        }\n    }\n}\n","export default class ConfigValuesNotSetError extends Error {\n\tconstructor() {\n\t\tsuper('Config values are not set');\n\t\tthis.name = \"ConfigValuesNotSetError\";\n\t}\n}\n","export default class FalsyConfigValueError extends Error {\n\tconstructor(attributeName: string) {\n\t\tsuper(`Falsy config value: ${attributeName}`);\n\t\tthis.name = \"FalsyConfigValueError\";\n\t}\n}\n","export default class UnknownConfigValueError extends Error {\n\tconstructor(attributeName: string) {\n\t\tsuper(`Unknown or undefined config value: ${attributeName}`);\n\t\tthis.name = \"UnknownConfigValueError\";\n\t}\n}\n","import ConfigValuesNotSetError from \"./errors/ConfigValuesNotSetError\";\nimport FalsyConfigValueError from \"./errors/FalsyConfigValueError\";\nimport UnknownConfigValueError from \"./errors/UnknownConfigValueError\";\nimport type { TConfigAttributes } from \"./types/config-attributes\";\nimport { TNullable } from \"./types/generic/nullable\";\n\nexport default class Config {\n\t/**\n\t * @private\n\t */\n\tprivate static attributes: TNullable<TConfigAttributes> = null;\n\n\t/**\n\t * @param attributes\n\t */\n\tpublic static setAll(attributes: TConfigAttributes) {\n\t\tconst keys = Object.keys(attributes) as (keyof TConfigAttributes)[];\n\n\t\tkeys.forEach((key) => {\n\t\t\tif (!attributes[key]) {\n\t\t\t\tthrow new FalsyConfigValueError(key);\n\t\t\t}\n\t\t});\n\n\t\tthis.attributes = attributes;\n\t}\n\n\t/**\n\t * @param attribute\n\t */\n\tpublic static get(attribute: keyof TConfigAttributes): string {\n\t\tif (this.attributes === null) {\n\t\t\tthrow new ConfigValuesNotSetError();\n\t\t}\n\t\tif (!this.attributes[attribute]) {\n\t\t\tthrow new UnknownConfigValueError(attribute);\n\t\t}\n\t\treturn this.attributes[attribute];\n\t}\n}\n","export default class UnknownMacroError extends Error {\n\tconstructor(macroName: string) {\n\t\tsuper(`Unknown macro: ${macroName}`);\n\t\tthis.name = \"UnknownMacroError\";\n\t}\n}\n","import type { TQueryBuilderMacroFunction } from './types/query-builder-macro-function';\nimport UnknownMacroError from \"./errors/UnknownMacroError\";\nimport {QueryBuilderInterface} from \"./contracts/QueryBuilderInterface\";\n\nexport default class MacroRegistry {\n    /**\n     * @private\n     */\n    private static macros: Record<string, TQueryBuilderMacroFunction> = {};\n\n    /**\n     * @param name\n     * @param call\n     */\n    public static register(name: string, call: TQueryBuilderMacroFunction) {\n        this.macros[name] = call;\n    }\n\n    /**\n     * @param name\n     * @param query\n     * @param args\n     */\n    public static execute(name: string, query: QueryBuilderInterface<unknown>, args: unknown[] = []) {\n        if (!this.macros[name]) {\n            throw new UnknownMacroError(name);\n        }\n\n        this.macros[name].call(this, query, ...(args as []));\n    }\n}\n","import type { ResponseModelInterface } from './contracts/ResponseModelInterface';\nimport type Model from './Model';\nimport type { TAutoMapperSelector } from './types/automapper-selector';\nimport type { TNullable } from './types/generic/nullable';\n\nexport default class AutoMapper {\n    /**\n     *\n     * @private\n     */\n    private static models: Record<string, typeof Model> = {};\n\n    /**\n     *\n     * @private\n     */\n    private static selector: TNullable<TAutoMapperSelector>;\n\n    /**\n     *\n     * @param selector\n     */\n    public static setSelector(selector: TAutoMapperSelector) {\n        this.selector = selector;\n    }\n\n    /**\n     *\n     * @param modelDefinitions\n     */\n    public static register(modelDefinitions: Record<string, typeof Model>) {\n        this.models = modelDefinitions;\n    }\n\n    /**\n     *\n     * @param responseModel\n     * @private\n     */\n    private static select(responseModel: ResponseModelInterface): TNullable<typeof Model> {\n        for (const value in this.models) {\n            if (this.selector && this.selector(responseModel, value)) {\n                return this.models[value];\n            }\n        }\n\n        return null;\n    }\n\n    /**\n     * @param responseModel\n     */\n    public static async map(responseModel: ResponseModelInterface) {\n        const ModelClass = this.select(responseModel);\n        if (ModelClass) {\n            return await ModelClass.createFromResponse(responseModel);\n        }\n\n        return responseModel;\n    }\n}\n","import { TResponseWithData } from \"../types/response-with-data\";\n\nexport function isResponseWithData(value: unknown): value is TResponseWithData {\n\treturn typeof value === \"object\" && value !== null && \"data\" in value;\n}\n","import AutoMapper from \"./AutoMapper\";\nimport type { ResponseModelInterface } from \"./contracts/ResponseModelInterface\";\nimport { isResponseWithData } from \"./typeguards/isResponseWithData\";\nimport { TNullable } from \"./types/generic/nullable\";\nimport Model from \"./Model\";\nimport {TModelClass} from \"./types/model-class\";\n\nexport default class ResponseModel implements ResponseModelInterface {\n\t/**\n\t * The raw, unprocessed response from the JSON:API\n\t * @private\n\t */\n\tprivate readonly rawResponse: unknown;\n\n\t/**\n\t * @param rawResponse\n\t */\n\tconstructor(rawResponse: unknown) {\n\t\tthis.rawResponse = rawResponse;\n\t}\n\n\t/**\n\t * Get the raw response from the ResponseModel\n\t */\n\tpublic getRawResponse(): unknown {\n\t\treturn this.rawResponse;\n\t}\n\n\t/**\n\t * Gets a field from the node\n\t * @param path\n\t * @param defaultValue\n\t */\n\tget<T>(path: string | string[], defaultValue: T): T {\n\t\tif (!Array.isArray(path)) {\n\t\t\tpath = path.replace(/\\[(\\d+)\\]/g, \".$1\").split(\".\");\n\t\t}\n\n\t\tlet result = this.rawResponse as Record<string, any>;\n\n\t\tfor (const key of path) {\n\t\t\tresult = Object.prototype.hasOwnProperty.call(result, key) ? result[key] : undefined;\n\t\t\tif (result === undefined || result === null) {\n\t\t\t\treturn defaultValue;\n\t\t\t}\n\t\t}\n\n\t\treturn result as T;\n\t}\n\n\t/**\n\t * Gets a relationship from the node and optionally map it\n\t * @param path\n\t * @param modelClass\n\t */\n\tasync hasOne<T extends Model>(path: string | string[], modelClass?: TModelClass<T>): Promise<TNullable<T>> {\n\n\t\tlet contentData: unknown = this.get(path, null);\n\n\t\tif (isResponseWithData(contentData)) {\n\t\t\tcontentData = contentData.data;\n\t\t}\n\n\t\tif (!contentData) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst responseModel = new ResponseModel(contentData);\n\n\t\t// A class was explicitly given\n\t\tif (modelClass) {\n\t\t\treturn await modelClass.createFromResponse(responseModel);\n\t\t}\n\n\t\t// Resort to automapping\n\t\treturn await AutoMapper.map(responseModel);\n\t}\n\n\t/**\n\t * @param path\n\t * @param modelClass\n\t */\n\tasync hasMany<T extends Model>(path: string | string[], modelClass?: TModelClass<T>): Promise<TNullable<T[]>> {\n\n\t\tlet contentData: unknown = this.get(path, null);\n\n\t\tif (!contentData) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (isResponseWithData(contentData)) {\n\t\t\tcontentData = contentData.data;\n\t\t}\n\n\t\tif (Array.isArray(contentData)) {\n\t\t\tconst result: T[] = [];\n\n\t\t\tfor (const item of contentData) {\n\t\t\t\tconst modelInstance = modelClass ?\n\t\t\t\t\tawait modelClass.createFromResponse(new ResponseModel(item)) :\n\t\t\t\t\tawait AutoMapper.map(new ResponseModel(item));\n\n\t\t\t\tif (modelInstance) {\n\t\t\t\t\tresult.push(modelInstance);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn result as T[];\n\t\t}\n\n\t\treturn null;\n\t}\n}\n","import Container from \"./Container\";\nimport QueryBuilder from \"./QueryBuilder\";\nimport type { ResponseModelInterface } from \"./contracts/ResponseModelInterface\";\nimport type { TMapper } from \"./types/mapper\";\nimport { DataProperties } from \"./types/generic/data-properties\";\n\nexport default abstract class Model {\n\t/**\n\t * @protected\n\t */\n\tprotected static primaryKey: string = \"id\";\n\n\t/**\n\t * @protected\n\t */\n\tprotected static defaultMacro: string;\n\n\t/**\n\t * @protected\n\t */\n\tprotected static endpoint: string;\n\n\t/**\n\t * @protected\n\t */\n\tprotected static include: string[] = [];\n\n\t/**\n\t * @param response\n\t */\n\tpublic static async createFromResponse(response: ResponseModelInterface) {\n\n\t\tif (! this.gate(response)) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst instance = new (this as any)();\n\t\tObject.assign(instance, await instance.map(response));\n\t\treturn instance;\n\t}\n\n\t/**\n\t * Create a QueryBuilder instance specifically for this model\n\t */\n\tpublic static query<T extends typeof Model>(this: T): QueryBuilder<InstanceType<T>> {\n\t\tif (!this.endpoint) {\n\t\t\tthrow new Error(`The model \"${this.name}\" doesn't have an endpoint, so can't be queried.`);\n\t\t}\n\n\t\tconst mapper: TMapper<Promise<InstanceType<T>>> = async (response: ResponseModelInterface): Promise<InstanceType<T>> => {\n\t\t\treturn await this.createFromResponse(response);\n\t\t};\n\n\t\t// Create a new QueryBuilder instance with the gate and includes\n\t\tconst query = Container.make('QueryBuilderInterface', this.endpoint, mapper)\n\t\t\t.gate(this.gate)\n\t\t\t.include(this.include);\n\n\t\t// Check if the model has a default macro\n\t\tif (this.defaultMacro) {\n\t\t\tquery.macro(this.defaultMacro);\n\t\t}\n\n\t\treturn query;\n\t}\n\n\t/**\n\t * @param responseModel\n\t */\n\tprotected map(responseModel: ResponseModelInterface): unknown {\n\t\treturn responseModel;\n\t}\n\n\t/**\n\t * @param responseModel\n\t * @protected\n\t */\n\tpublic static gate(responseModel: ResponseModelInterface): boolean {\n\t\treturn true;\n\t}\n\n\t/**\n\t *\n\t */\n\tpublic serialize<T extends Model>(this: T): DataProperties<T> {\n\n\t\tconst data: Record<string, any> = {};\n\n\t\tfor (const key of Object.keys(this)) {\n\t\t\tconst value = (this as any)[key];\n\n\t\t\tif (value instanceof Model) {\n\t\t\t\tdata[key] = value.serialize();\n\t\t\t} else if (Array.isArray(value)) {\n\t\t\t\t// Support arrays of models\n\t\t\t\tdata[key] = value.map(v =>\n\t\t\t\t\tv instanceof Model ? v.serialize() : v\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tdata[key] = value;\n\t\t\t}\n\t\t}\n\n\t\treturn data as DataProperties<T>;\n\t}\n}\n","import type { TResultSetMeta } from './types/resultset-meta';\nimport {TNullable} from \"./types/generic/nullable\";\nimport Model from \"./Model\";\nimport {DataProperties} from \"./types/generic/data-properties\";\n\nexport default class ResultSet<T> implements Iterable<T> {\n\n    /**\n     * @private\n     */\n    private readonly items: T[] = [];\n\n    /**\n     *\n     */\n    public meta: TNullable<TResultSetMeta> = null;\n\n    /**\n     * @param initialItems\n     */\n    constructor(initialItems: T[] = []) {\n        this.items = initialItems;\n    }\n\n    /**\n     * @param meta\n     */\n    public setMeta(meta: TResultSetMeta) {\n        this.meta = meta;\n    }\n\n    // Make the class iterable by implementing Symbol.iterator\n    [Symbol.iterator](): Iterator<T> {\n        let index = 0;\n        const items = this.items;\n\n        return {\n            next(): IteratorResult<T> {\n                if (index < items.length) {\n                    return { value: items[index++], done: false };\n                }\n                else {\n                    return { value: undefined as unknown as T, done: true };\n                }\n            },\n        };\n    }\n\n    get length() {\n        return this.items.length;\n    }\n\n    get(index: number): T {\n        return this.items[index];\n    }\n\n    // Array-like methods, delegating to the internal array\n    push(item: T): number {\n        return this.items.push(item);\n    }\n\n    pop(): T | undefined {\n        return this.items.pop();\n    }\n\n    map<U>(callback: (value: T, index: number, array: T[]) => U): U[] {\n        return this.items.map(callback);\n    }\n\n    sort(compareFn?: (a: T, b: T) => number): T[] {\n        this.items.sort(compareFn);\n        return this.items;\n    }\n\n    forEach<U>(callback: (value: T, index: number, array: T[]) => U) {\n        return this.items.forEach(callback);\n    }\n\n    filter(callback: (value: T, index: number, array: T[]) => boolean): T[] {\n        return this.items.filter(callback);\n    }\n\n    find(callback: (value: T, index: number, array: T[]) => boolean): T | undefined {\n        return this.items.find(callback);\n    }\n\n    reduce<U>(callback: (accumulator: U, currentValue: T, index: number, array: T[]) => U, initialValue: U): U {\n        return this.items.reduce(callback, initialValue);\n    }\n\n    toArray(): T[] {\n        return this.items;\n    }\n\n    concat(resultSet: ResultSet<T>): ResultSet<T> {\n\n        const originalMeta = this.meta;\n        const newMeta = resultSet.meta;\n\n        const newResultSet = new ResultSet(this.toArray().concat(resultSet.toArray()));\n\n        // Also concat the relevant meta\n        newResultSet.setMeta({\n            ...originalMeta,\n            performance: {\n                query: originalMeta.performance.query + newMeta.performance.query,\n                mapping: originalMeta.performance.mapping + newMeta.performance.mapping,\n            },\n            excludedByGate: originalMeta.excludedByGate + newMeta.excludedByGate,\n        });\n\n        return newResultSet;\n    }\n\n    serialize(): Array<DataProperties<T>> {\n        return this.items.map(item => {\n            if (item instanceof Model) {\n                return item.serialize();\n            }\n            return item;\n        }) as Array<DataProperties<T>>;\n    }\n}\n","export default class InvalidResponseError extends Error {\n\tconstructor(additionalMessage: string = 'Unknown reason') {\n\t\tsuper(`Invalid response: ${additionalMessage}`);\n\t\tthis.name = \"InvalidResponseError\";\n\t}\n}\n","import { TJsonApiResponse } from \"../types/json-api-response\";\n\nexport function isJsonApiResponse(value: unknown): value is TJsonApiResponse {\n\treturn (\n\t\ttypeof value === \"object\" &&\n\t\tvalue !== null &&\n\t\t\"jsonapi\" in value &&\n\t\t\"data\" in value &&\n\t\ttypeof value.data === \"object\" &&\n\t\tvalue.jsonapi !== null &&\n\t\ttypeof value.jsonapi === \"object\" &&\n\t\t\"version\" in value.jsonapi &&\n\t\ttypeof value.jsonapi.version === \"string\" &&\n\t\tvalue.jsonapi.version.startsWith(\"1\")\n\t);\n}\n","import {TRawResponse} from \"../types/raw-response\";\n\nexport function isRawResponse(value: unknown): value is TRawResponse {\n\n\treturn (\n\t\ttypeof value === \"object\" &&\n\t\tvalue !== null\n\t);\n}","import { TResponseWithErrors } from \"../types/response-with-errors\";\n\nexport function isResponseWithErrors(value: unknown): value is TResponseWithErrors {\n\treturn (\n\t\ttypeof value === \"object\" &&\n\t\tvalue !== null &&\n\t\t\"errors\" in value &&\n\t\tArray.isArray(value.errors) &&\n\t\tvalue.errors.length > 0\n\t);\n}\n","import {TQueryParams} from \"../types/query-params\";\n\nexport function makeSearchParams(params: TQueryParams) {\n\n    const searchParams = new URLSearchParams();\n    const paramKeys = Object.keys(params);\n\n    paramKeys.forEach(paramKey => {\n        if (Array.isArray(params[paramKey])) {\n            params[paramKey].forEach((value, index) => {\n                searchParams.append(`${paramKey}[${index+1}]`, value);\n            });\n        } else {\n            searchParams.append(paramKey, params[paramKey] as string);\n        }\n    });\n\n    return searchParams;\n}\n","import MacroRegistry from \"./MacroRegistry\";\nimport ResponseModel from \"./ResponseModel\";\nimport ResultSet from \"./ResultSet\";\nimport type { QueryBuilderInterface } from \"./contracts/QueryBuilderInterface\";\nimport InvalidResponseError from \"./errors/InvalidResponseError\";\nimport { isJsonApiResponse } from \"./typeguards/isJsonApiResponse\";\nimport { isRawResponse } from \"./typeguards/isRawResponse\";\nimport { isResponseWithErrors } from \"./typeguards/isResponseWithErrors\";\nimport type { TFilterOperator } from \"./types/filter-operator\";\nimport type { TNullable } from \"./types/generic/nullable\";\nimport { TJsonApiResponse } from \"./types/json-api-response\";\nimport type { TMapper } from \"./types/mapper\";\nimport { TQueryBuilderGroupingFunction } from \"./types/query-builder-grouping-function\";\nimport {TQueryParams, TQueryParamValue} from \"./types/query-params\";\nimport type { TResultSetMeta } from \"./types/resultset-meta\";\nimport { makeSearchParams } from \"./utils/http\";\nimport Model from \"./Model\";\nimport {TDataGateFunction} from \"./types/data-gate-function\";\nimport {ClientInterface} from \"./contracts/ClientInterface\";\nimport {EventBusInterface} from \"./contracts/EventBusInterface\";\n\n/**\n * This class provides an easy-to-use interface to build queries\n * specifically for JSON:API\n */\nexport default class QueryBuilder<T extends Model> implements QueryBuilderInterface<T> {\n\t/**\n\t * The locale in which we're going to query the entries\n\t * @private\n\t */\n\tprivate locale?: string;\n\n\t/**\n\t * The actual HTTP client\n\t * @private\n\t */\n\tprivate readonly client: ClientInterface;\n\n\t/**\n\t * The event bus to use when emitting events\n\t * @private\n\t */\n\tprivate readonly events: EventBusInterface;\n\n\t/**\n\t * The mapping function to use when we received the response\n\t * @private\n\t */\n\tprivate readonly mapper: TMapper<Promise<T>>;\n\n\t/**\n\t * @private\n\t */\n\tprivate readonly endpoint: string;\n\n\t/**\n\t * The registered query params\n\t * @private\n\t */\n\tprivate readonly queryParams: TQueryParams;\n\n\t/**\n\t * @private\n\t */\n\tprivate pageLimit: TNullable<number> = null;\n\n\t/**\n\t * @private\n\t */\n\tprivate pageOffset: TNullable<number> = null;\n\n\t/**\n\t * @private\n\t */\n\tprivate dataGate: TNullable<TDataGateFunction> = null;\n\n\t/**\n\t * The cache policy to pass to the Client once the query executes\n\t * @private\n\t */\n\tprivate cachePolicy: \"force-cache\" | \"no-store\" = \"force-cache\";\n\n\t/**\n\t *\n\t * @private\n\t */\n\tprivate response!: TJsonApiResponse;\n\n\t/**\n\t * The last used filter group id, increments with each use of a filter-method to generate a unique filter group name\n\t * @private\n\t */\n\tprivate lastFilterGroupId: number = 0;\n\n\t/**\n\t *\n\t * @private\n\t */\n\tprivate currentFilterGroupName: TNullable<string> = null;\n\n\t/**\n\t * @param client\n\t * @param events\n\t * @param endpoint\n\t * @param mapper\n\t */\n\tconstructor(client: ClientInterface, events: EventBusInterface, endpoint: string, mapper: TMapper<Promise<T>>) {\n\t\tthis.client = client;\n\t\tthis.events = events;\n\t\tthis.endpoint = endpoint;\n\t\tthis.mapper = mapper;\n\t\tthis.queryParams = {};\n\t}\n\n\t/**\n\t * Executes a macro registered on MacroRegistry\n\t * @param name\n\t * @param args\n\t */\n\tpublic macro(name: string, ...args: unknown[]): this {\n\t\tMacroRegistry.execute(name, this, args);\n\t\treturn this;\n\t}\n\n\t/**\n\t * @param gateFunction\n\t */\n\tpublic gate(gateFunction: TDataGateFunction): this {\n\t\tthis.dataGate = gateFunction;\n\t\treturn this;\n\t}\n\n\t/**\n\t * Disabled caching on the request\n\t */\n\tpublic noCache(): this {\n\t\tthis.cachePolicy = \"no-store\";\n\t\treturn this;\n\t}\n\n\t/**\n\t * Forces caching on the request\n\t */\n\tpublic cache(): this {\n\t\tthis.cachePolicy = \"force-cache\";\n\t\treturn this;\n\t}\n\n\t/**\n\t * Sets the locale of the query\n\t * @param locale\n\t */\n\tpublic setLocale(locale: string): this {\n\t\tthis.locale = locale;\n\t\treturn this;\n\t}\n\n\t/**\n\t * Registers one query param\n\t * @param name\n\t * @param value\n\t */\n\tpublic param(name: string, value: TQueryParamValue): this {\n\t\tthis.queryParams[name] = value;\n\t\tthis.events.emit('paramAdded', { name, value });\n\t\treturn this;\n\t}\n\n\t/**\n\t * Registers multiple query params\n\t * @param params\n\t */\n\tpublic params(params: TQueryParams): this {\n\t\tObject.keys(params).forEach((key) => {\n\t\t\tthis.param(key, params[key]);\n\t\t});\n\t\treturn this;\n\t}\n\n\t/**\n\t * @param path\n\t * @param operator\n\t * @param value\n\t */\n\tpublic where(path: string, operator: TFilterOperator, value: TNullable<TQueryParamValue> = null): this {\n\t\tconst groupName = this.createFilterGroupName();\n\t\tthis.assignFilterGroupToCurrentFilterGroup(groupName);\n\n\t\tthis.param(`filter[${groupName}][condition][path]`, path);\n\t\tthis.param(`filter[${groupName}][condition][operator]`, operator);\n\n\t\tif (value === null) {\n\t\t\tif (operator === 'IS NULL' || operator === 'IS NOT NULL') {\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\tthrow new TypeError(`Value given was null, while the given operator ${operator} expects string or array of strings`);\n\t\t}\n\n\t\tif (\n\t\t\t(operator === 'BETWEEN' || operator === 'NOT BETWEEN') &&\n\t\t\t(!Array.isArray(value) || value.length !== 2)\n\t\t) {\n\t\t\tthrow new TypeError(`Operator ${operator} expects an array with exactly 2 items`);\n\t\t}\n\n\t\t// Check for IN and NOT IN operators (which use an array to pass values)\n\t\tif (operator === 'IN' || operator === 'NOT IN') {\n\t\t\t// Is value already an array?\n\t\t\tif (Array.isArray(value)) {\n\t\t\t\t// Pass it directly!\n\t\t\t\tthis.param(`filter[${groupName}][condition][value]`, value);\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\t// If not an array, make it an array\n\t\t\tthis.param(`filter[${groupName}][condition][value]`, [value as string]);\n\t\t\treturn this;\n\t\t}\n\n\t\t// If the value is passed is an array, but neither IN or NOT IN was used as operator\n\t\tif (Array.isArray(value)) {\n\t\t\t// I guess we'll just join the values so it's a string\n\t\t\tthis.param(`filter[${groupName}][condition][value]`, value.join(''));\n\t\t\treturn this;\n\t\t}\n\n\t\t// Value is a string, just pass it as a singular param\n\t\tthis.param(`filter[${groupName}][condition][value]`, value);\n\t\treturn this;\n\t}\n\n\t/**\n\t * @param path\n\t * @param values\n\t */\n\tpublic whereIn(path: string, values: string[] | number[]): this {\n\t\tthis.where(path, 'IN', values);\n\t\treturn this;\n\t}\n\n\t/**\n\t * @param path\n\t * @param values\n\t */\n\tpublic whereNotIn(path: string, values: string[] | number[]): this {\n\t\tthis.where(path, 'NOT IN', values);\n\t\treturn this;\n\t}\n\n\t/**\n\t * @param path\n\t */\n\tpublic whereIsNull(path: string): this {\n\t\tthis.where(path, 'IS NULL');\n\t\treturn this;\n\t}\n\n\t/**\n\t * @param path\n\t */\n\tpublic whereIsNotNull(path: string): this {\n\t\tthis.where(path, 'IS NOT NULL');\n\t\treturn this;\n\t}\n\n\t/**\n\t * Registers includes (as described by JSON:API)\n\t * @param includes\n\t */\n\tpublic include(includes: string[]): this {\n\t\tif (includes.length) {\n\t\t\tthis.param(\"jsonapi_include\", 1);\n\t\t\tthis.param(\"include\", includes.join(\",\"));\n\t\t}\n\t\treturn this;\n\t}\n\n\t/**\n\t * @param amount\n\t */\n\tpublic limit(amount: number): this {\n\t\tthis.pageLimit = amount;\n\t\tthis.param(\"page[limit]\", amount);\n\t\treturn this;\n\t}\n\n\t/**\n\t * @param page\n\t * @param perPage\n\t */\n\tpaginate(page: number, perPage: number): this {\n\t\tconst offset = Math.max(page - 1, 0) * perPage;\n\t\tthis.pageOffset = offset;\n\t\tthis.param(\"page[offset]\", offset);\n\t\tthis.limit(perPage);\n\t\treturn this;\n\t}\n\n\t/**\n\t * @param path\n\t * @param direction\n\t */\n\tpublic sort(path: string, direction: \"asc\" | \"desc\" = \"asc\"): this {\n\t\tconst groupName = this.createFilterGroupName();\n\t\tthis.param(`sort[${groupName}][path]`, path);\n\t\tthis.param(`sort[${groupName}][direction]`, direction);\n\t\treturn this;\n\t}\n\n\t/**\n\t *\n\t * @param operator\n\t * @param groupingFunction\n\t */\n\tpublic group(operator: \"or\" | \"and\", groupingFunction: TQueryBuilderGroupingFunction<T>): this {\n\t\tconst currentFilterGroupName = this.currentFilterGroupName;\n\t\tconst newGroupName = this.createFilterGroupName();\n\t\tthis.assignFilterGroupToCurrentFilterGroup(newGroupName);\n\t\tthis.currentFilterGroupName = newGroupName;\n\t\tthis.param(`filter[${this.currentFilterGroupName}][group][conjunction]`, operator.toUpperCase());\n\t\tgroupingFunction(this);\n\t\tthis.currentFilterGroupName = currentFilterGroupName;\n\t\treturn this;\n\t}\n\n\t/**\n\t * @private\n\t */\n\tprivate createFilterGroupName(): string {\n\t\tthis.lastFilterGroupId = this.lastFilterGroupId + 1;\n\t\treturn `g${this.lastFilterGroupId}`;\n\t}\n\n\t/**\n\t * @param groupName\n\t * @private\n\t */\n\tprivate assignFilterGroupToCurrentFilterGroup(groupName: string) {\n\t\tif (this.currentFilterGroupName) {\n\t\t\tthis.param(`filter[${groupName}][condition][memberOf]`, this.currentFilterGroupName);\n\t\t}\n\t}\n\n\t/**\n\t * @param path\n\t * @private\n\t */\n\tprivate buildUrl(path: string): string {\n\t\tconst queryString = (makeSearchParams(this.queryParams)).toString();\n\t\treturn `${this.locale ? `${this.locale}/` : \"\"}${path}/${queryString ? `?${queryString}` : \"\"}`;\n\t}\n\n\t/**\n\t * Executes the query (GET)\n\t */\n\tprivate async performGetRequest(path: string) {\n\t\tthis.events.emit('preFetch', { url: path });\n\n\t\tconst response = await this.client.get(path, {\n\t\t\tcache: this.cachePolicy,\n\t\t});\n\n\t\tthis.events.emit('postFetch', { url: path });\n\n\t\treturn response;\n\t}\n\n\t/**\n\t * Fetches the endpoint and uses the raw response to pass to the mapper\n\t */\n\tpublic async getRaw(): Promise<T> {\n\t\tconst response = await this.performGetRequest(this.buildUrl(this.endpoint));\n\n\t\tif (!isRawResponse(response)) {\n\t\t\tthrow new InvalidResponseError();\n\t\t}\n\n\t\tif (!this.mapper) {\n\t\t\tthrow new Error(\"No mapper\");\n\t\t}\n\n\t\treturn await this.mapper(new ResponseModel(response));\n\t}\n\n\t/**\n\t * Maps and returns all entries (paginated) in the response\n\t */\n\tpublic async get(): Promise<ResultSet<T>> {\n\t\tlet start = performance.now();\n\t\tconst url = this.buildUrl(this.endpoint);\n\t\tconst response = await this.performGetRequest(url);\n\n\t\tif (isResponseWithErrors(response)) {\n\t\t\tconst firstError = response.errors[0];\n\t\t\tthrow new InvalidResponseError(`${firstError.title} (status: ${firstError.status}): ${firstError.detail}`);\n\t\t}\n\n\t\tif (!isJsonApiResponse(response)) {\n\t\t\tthrow new InvalidResponseError(\n\t\t\t\t\"Couldn't verify the response as a valid JSON:API response. Potentially this is not a JSON:API resource or the JSON:API has a version mismatch (expected 1.0)\"\n\t\t\t);\n\t\t}\n\n\t\tthis.response = response;\n\n\t\tconst queryDuration = performance.now() - start;\n\t\tstart = performance.now();\n\n\t\tconst responseModels = this.response.data.map((entry: unknown) => new ResponseModel(entry));\n\n\t\tif (!this.mapper) {\n\t\t\tthrow new Error(\"No mapper\");\n\t\t}\n\n\t\tconst resultSet = new ResultSet<T>();\n\n\t\tlet itemCountExcludedByGate = 0;\n\t\tfor await (const item of responseModels) {\n\t\t\tif (this.dataGate && ! this.dataGate(item)) {\n\t\t\t\titemCountExcludedByGate++;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst mapped = await this.mapper(item);\n\t\t\tresultSet.push(mapped);\n\t\t}\n\n\t\tconst mappingDuration = performance.now() - start;\n\n\t\tlet meta: TResultSetMeta = {\n\t\t\tquery: {\n\t\t\t\turl,\n\t\t\t\tparams: this.queryParams,\n\t\t\t},\n\t\t\tperformance: {\n\t\t\t\tquery: queryDuration,\n\t\t\t\tmapping: mappingDuration,\n\t\t\t},\n\t\t\texcludedByGate: itemCountExcludedByGate\n\t\t};\n\n\t\tif (this.response.meta) {\n\t\t\tmeta = {\n\t\t\t\tcount: this.response.meta.count || 0,\n\t\t\t\tpages: this.pageLimit ? Math.ceil(this.response.meta.count / this.pageLimit) : 1,\n\t\t\t\tperPage: this.pageLimit ? this.pageLimit : this.response.meta.count,\n\t\t\t\t...meta,\n\t\t\t};\n\t\t}\n\n\t\tresultSet.setMeta(meta);\n\n\t\treturn resultSet;\n\t}\n\n\t/**\n\t * Maps and returns all entries across all pages\n\t */\n\tpublic async all(batchSize: number = 50): Promise<ResultSet<T>> {\n\n\t\t// Set pagination for the first fetch\n\t\tthis.paginate(1, batchSize);\n\n\t\tconst firstResult = await this.get();\n\t\tconst { pages, perPage } = firstResult.meta;\n\n\t\t// If there's only 1 page, just return the already fetched ResultSet\n\t\tif (pages === 1) {\n\t\t\treturn firstResult;\n\t\t}\n\n\t\t// Continue to fetch the other pages\n\t\tlet currentPage = 2;\n\t\tlet resultSet = firstResult;\n\t\twhile (currentPage <= pages) {\n\t\t\tconst pagedResult = await this.paginate(currentPage, perPage).get();\n\n\t\t\t// Concat the result sets\n\t\t\tresultSet = resultSet.concat(pagedResult);\n\t\t\tcurrentPage++;\n\t\t}\n\n\t\t// Modify the meta of the resulting ResultSet\n\t\tresultSet.setMeta({\n\t\t\t...resultSet.meta,\n\t\t\tpages: 1,\n\t\t\tperPage: resultSet.meta.count\n\t\t});\n\n\t\treturn resultSet;\n\t}\n\n\t/**\n\t * Gets and maps the first item from the query\n\t */\n\tpublic async first(): Promise<T | ResponseModel> {\n\t\treturn (await this.get()).get(0);\n\t}\n\n\t/**\n\t * Gets a single entry by UUID\n\t * @param uuid\n\t */\n\tpublic async find(uuid: string | number): Promise<T> {\n\t\tif (!this.mapper) {\n\t\t\tthrow new Error(\"No mapper\");\n\t\t}\n\n\t\tconst response = await this.performGetRequest(this.buildUrl(`${this.endpoint}/${uuid}`));\n\n\t\tif (isResponseWithErrors(response)) {\n\t\t\tconst firstError = response.errors[0];\n\t\t\tthrow new InvalidResponseError(`${firstError.title} (status: ${firstError.status}): ${firstError.detail}`);\n\t\t}\n\n\t\tif (!isJsonApiResponse(response)) {\n\t\t\tthrow new InvalidResponseError(\n\t\t\t\t\"Couldn't verify the response as a valid JSON:API response. Potentially this is not a JSON:API resource or the JSON:API has a version mismatch (expected 1.0)\"\n\t\t\t);\n\t\t}\n\n\t\tthis.response = response;\n\n\t\treturn this.mapper(new ResponseModel(this.response.data));\n\t}\n\n\t/**\n\t * Turns the QueryBuilder into a string\n\t */\n\tpublic toString(): string {\n\t\treturn this.buildUrl(this.endpoint);\n\t}\n}\n","export default class AuthTokenError extends Error {\n\tconstructor(message: string, url: string = '') {\n\t\tsuper(`Couldn\\'t generate auth token: ${message}. Using URL ${url}. Are you sure your credentials are correct and the API responds with a JSON:API response?`);\n\t\tthis.name = \"AuthTokenError\";\n\t}\n}\n","import AuthTokenError from \"../errors/AuthTokenError\";\nimport { AuthInterface } from \"../contracts/AuthInterface\";\n\nexport default class OAuth implements AuthInterface {\n    /**\n     * @private\n     */\n    private readonly baseUrl: string;\n\n    /**\n     * @private\n     */\n    private readonly clientId: string;\n\n    /**\n     * @private\n     */\n    private readonly clientSecret: string;\n\n    /**\n     * @param baseUrl\n     * @param clientId\n     * @param clientSecret\n     */\n    constructor(baseUrl: string, clientId: string, clientSecret: string) {\n        this.baseUrl = baseUrl;\n        this.clientId = clientId;\n        this.clientSecret = clientSecret;\n    }\n\n    /**\n     * @private\n     */\n    private accessToken?: string;\n\n    /**\n     * @private\n     */\n    private accessTokenExpiryDate?: number;\n\n    /**\n     * Gets the HTTP Headers\n     */\n    public async getHttpHeaders(): Promise<Record<string, string>> {\n        const token = await this.getAuthToken();\n\n        return {\n            Authorization: `Bearer ${token}`,\n        };\n    }\n\n    /**\n     * Gets the authentication token\n     */\n    public async getAuthToken(): Promise<string> {\n        if (\n            !this.accessToken\n            || !this.accessTokenExpiryDate\n            || new Date().getTime() >= this.accessTokenExpiryDate\n        ) {\n            return await this.generateAuthToken();\n        }\n\n        return this.accessToken;\n    }\n\n    /**\n     * Generates a new auth token, stores it as properties and returns it\n     */\n    private async generateAuthToken(): Promise<string> {\n\n        const url = `${this.baseUrl}/oauth/token`;\n\n        const requestBody = new FormData();\n        requestBody.append('grant_type', 'client_credentials');\n        requestBody.append('client_id', this.clientId);\n        requestBody.append('client_secret', this.clientSecret);\n\n        let json;\n\n        try {\n            const response = await fetch(url, {\n                method: 'POST',\n                body: requestBody,\n                headers: {\n                    Accept: 'application/json',\n                },\n            });\n\n            json = await response.json();\n        }\n        catch (e: unknown) {\n            if (e instanceof Error) {\n                throw new AuthTokenError(e.message, url);\n            }\n            throw new AuthTokenError(`Couldn\\'t generate auth token: Unknown error.`, url);\n        }\n\n        if (! json.access_token) {\n            throw new AuthTokenError(`${json.error}: ${json.error_description}`, url);\n        }\n\n        // Store the access token and expiry date in memory\n        this.accessToken = json.access_token as string;\n        this.accessTokenExpiryDate = new Date().getTime() + json.expires_in;\n\n        return this.accessToken;\n    }\n}\n","import { EventBusInterface } from \"./contracts/EventBusInterface\";\nimport { TEvent, TEventListener } from \"./types/event-bus\";\n\ntype TListenerEntry = {\n    id: number;\n    listener: TEventListener;\n};\n\ntype TListenerMap = Record<string, TListenerEntry[]>;\n\nexport default class EventBus implements EventBusInterface {\n    /**\n     * The current id\n     * @private\n     */\n    private currentId: number = 0;\n\n    /**\n     *\n     * @private\n     */\n    private eventIdMap: Record<number, string> = {};\n\n    /**\n     * The registered event listeners\n     */\n    private listeners: TListenerMap = {};\n\n    /**\n     * Adds an event listener\n     * @param eventKey\n     * @param listener\n     */\n    public on(eventKey: string, listener: TEventListener) {\n        // Increment the id\n        const id = ++this.currentId;\n\n        // If no listeners were added for this event key, make sure the property exists\n        if (! this.listeners[eventKey]) {\n            this.listeners[eventKey] = [];\n        }\n\n        // Register the event listener\n        this.eventIdMap[id] = eventKey;\n        this.listeners[eventKey].push({ id, listener });\n\n        return () => this.off(id);\n    }\n\n    /**\n     * Removes an event listener\n     * @param eventId\n     */\n    public off(eventId: number) {\n        const eventKey = this.eventIdMap[eventId];\n\n        if (! eventKey) {\n            return;\n        }\n\n        const listeners = this.listeners[eventKey];\n\n        if (! listeners || ! listeners.length) {\n            return;\n        }\n\n        // Filter out the current listener entry (remove it)\n        this.listeners[eventKey] = listeners.filter(listenerEntry => {\n            return listenerEntry.id !== eventId;\n        });\n\n        // Remove the id from the map\n        delete this.eventIdMap[eventId];\n    }\n\n    /**\n     * Emits an event with the given event data\n     * @param eventKey\n     * @param event\n     */\n    public emit(eventKey: string, event: TEvent = {}) {\n        if (! this.listeners[eventKey]) {\n            return;\n        }\n\n        // Fire the registered listeners\n        this.listeners[eventKey].forEach(listenerEntry => {\n            listenerEntry.listener(event);\n        });\n    }\n}","import type { TConfigAttributes } from './types/config-attributes';\nimport Container from \"./Container\";\nimport Client from \"./Client\";\nimport Config from \"./Config\";\nimport QueryBuilder from \"./QueryBuilder\";\nimport { TMapper } from \"./types/mapper\";\nimport OAuth from \"./auth/OAuth\";\nimport EventBus from \"./EventBus\";\n\nexport default class JsonApi {\n\n\tpublic static init(config: TConfigAttributes) {\n\n\t\tConfig.setAll(config);\n\n\t\tContainer.singleton('EventBusInterface', () => {\n\t\t\treturn new EventBus();\n\t\t});\n\n\t\tContainer.bind('QueryBuilderInterface', (endpoint: string, mapper: TMapper<any>) => {\n\t\t\treturn new QueryBuilder(\n\t\t\t\tContainer.make('ClientInterface'),\n\t\t\t\tContainer.make('EventBusInterface'),\n\t\t\t\tendpoint,\n\t\t\t\tmapper,\n\t\t\t);\n\t\t});\n\n\t\tContainer.singleton('AuthInterface', () => {\n\t\t\treturn new OAuth(\n\t\t\t\tConfig.get('baseUrl'),\n\t\t\t\tConfig.get('clientId'),\n\t\t\t\tConfig.get('clientSecret')\n\t\t\t);\n\t\t});\n\n\t\tContainer.singleton('ClientInterface', () => {\n\t\t\treturn new Client(Container.make('AuthInterface'), Config.get('baseUrl'));\n\t\t});\n\t}\n}\n","import Container from \"../Container\";\nimport { TEventListener } from \"../types/event-bus\";\n\nexport function events() {\n    return Container.make('EventBusInterface');\n}\n\nexport function on(eventKey: string, listener: TEventListener) {\n    return events().on(eventKey, listener);\n}\n\nexport function off(eventId: number) {\n    return events().off(eventId);\n}","import Container from \"../Container\";\nimport { TMapper } from \"../types/mapper\";\nimport ResponseModel from \"../ResponseModel\";\n\nconst defaultMapper = (response: ResponseModel) => {\n    return response;\n};\n\nexport default function query(endpoint: string, mapper: TMapper<any> = defaultMapper) {\n    return Container.make('QueryBuilderInterface', endpoint, mapper);\n}","import Container from \"../Container\";\n\nexport default function client() {\n    return Container.make('ClientInterface');\n}"],"mappings":"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","names":["query","query","client","events"]}